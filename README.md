knetstat
========

knetstat is a simple Linux kernel module that adds two new files to `/proc/net`: `tcpstat` and `tcp6stat`. The content of these files is roughly equivalent to the output of `netstat` with options `-t4an` and `-t6an` respectively, i.e. they provide information about TCP sockets in human readable form. The difference with the corresponding `netstat` output is that they have an additional column that displays (a subset of) the socket options. This was the primary motivation for writing the knetstat kernel module: currently, on Linux there is no way for an administrator to inspect the options set on a socket created by some process (other than using `strace` or an equivalent tool on that process at socket creation/configuration time), because this information is not exposed through the `/proc` file system.

knetstat internally reuses the infrastructure that is used by the kernel to generate the content of the `/proc/net/tcp` and `/proc/net/tcp6` files. This means that there is a one-to-one correspondence between the entries in these files and the entries in the files generated by knetstat. Only the formatting and information content is different between the two.

Here is some sample output:

    $ cat /proc/net/tcpstat 
    Proto Recv-Q Send-Q Local Address           Foreign Address         State       Options
    tcp        0      0 127.0.0.1:6010          0.0.0.0:*               LISTEN      SO_REUSEADDR=1,SO_KEEPALIVE=0
    tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      SO_REUSEADDR=1,SO_KEEPALIVE=0
    tcp        0      0 192.168.1.15:22         192.168.1.6:57125       ESTABLISHED SO_REUSEADDR=1,SO_KEEPALIVE=1

Currently supported features:

* Protocols: TCP (IPv4 and IPv6)
* Socket options: `SO_REUSEADDR`, `SO_KEEPALIVE`, `SO_RCVBUF`, `SO_SNDBUF`

To build the module, ensure that you have the headers for the currently running kernel as well as the basic build tools such as make and GCC. E.g. on Ubuntu:

    # apt-get install linux-headers-$(uname -r) make gcc

Then check out the knetstat source code and execute `make`. This should create `knetstat.ko` which can be loaded using `insmod`.
